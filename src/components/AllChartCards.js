import React, {useEffect, useState} from 'react';
import { makeStyles } from '@material-ui/core/styles';
import GridList from '@material-ui/core/GridList';
import GridListTile from '@material-ui/core/GridListTile';
import ChartCard from "./ChartCard";
import {json} from "d3-fetch";
import myJsonData from "../data/rt.json";

let tileData = [
    {
        country: "United States",
        rtValue: 1.64,
    },
    {
        country: "United States",
        rtValue: 1.64,
    },
    {
        country: "United States",
        rtValue: 1.64,
    },
    {
        country: "United States",
        rtValue: 1.64,
    },
    {
        country: "United States",
        rtValue: 1.64,
    },
    {
        country: "United States",
        rtValue: 1.64,
    },
];

const formatJson = (jsonData) => {
    let processedData = [];

    for (let [country, countryData] of Object.entries(jsonData)) {
        let countryObj = {};
        countryObj["id"] = country;
        countryObj["data"] = [];
        for (let [date, timeData] of Object.entries(countryData)) {
            let dataPoint = {};
            dataPoint["x"] = date;
            dataPoint["y"] = timeData["ML"];
            countryObj["data"].push(dataPoint);
        }
        processedData.push(countryObj);
    }
    return processedData;
};

const useStyles = makeStyles((theme) => ({
    root: {
        display: 'flex',
        flexWrap: 'wrap',
        justifyContent: 'space-around',
        overflow: 'hidden',
        backgroundColor: theme.palette.background.paper,
    },
    gridList: {
        width: "100%",
        height: Math.ceil(tileData.length / 3) * 400 + 20,
    },
}));

export default function AllChartCards() {
    const classes = useStyles();

    //fetch actual json data from file
    let jsonData = {
        "China": {
            "2020-01-19": {
                "ML": 4.0,
                "Low_50": 3.32,
                "High_50": 4.49
            },
            "2020-01-20": {
                "ML": 3.35,
                "Low_50": 2.89,
                "High_50": 3.67
            },
            "2020-01-21": {
                "ML": 3.1,
                "Low_50": 2.71,
                "High_50": 3.33
            },
            "2020-01-22": {
                "ML": 3.13,
                "Low_50": 2.81,
                "High_50": 3.33
            },
            "2020-01-23": {
                "ML": 3.35,
                "Low_50": 3.07,
                "High_50": 3.52
            },
            "2020-01-24": {
                "ML": 3.56,
                "Low_50": 3.3,
                "High_50": 3.69
            },
            "2020-01-25": {
                "ML": 3.93,
                "Low_50": 3.72,
                "High_50": 4.05
            },
            "2020-01-26": {
                "ML": 3.7,
                "Low_50": 3.52,
                "High_50": 3.8
            },
            "2020-01-27": {
                "ML": 3.32,
                "Low_50": 3.15,
                "High_50": 3.4
            },
            "2020-01-28": {
                "ML": 2.84,
                "Low_50": 2.73,
                "High_50": 2.95
            },
            "2020-01-29": {
                "ML": 2.38,
                "Low_50": 2.24,
                "High_50": 2.45
            },
            "2020-01-30": {
                "ML": 2.09,
                "Low_50": 1.95,
                "High_50": 2.15
            },
            "2020-01-31": {
                "ML": 1.92,
                "Low_50": 1.79,
                "High_50": 1.98
            },
            "2020-02-01": {
                "ML": 1.82,
                "Low_50": 1.7,
                "High_50": 1.88
            },
            "2020-02-02": {
                "ML": 1.91,
                "Low_50": 1.81,
                "High_50": 1.98
            },
            "2020-02-03": {
                "ML": 1.85,
                "Low_50": 1.76,
                "High_50": 1.92
            },
            "2020-02-04": {
                "ML": 1.66,
                "Low_50": 1.55,
                "High_50": 1.71
            },
            "2020-02-05": {
                "ML": 1.46,
                "Low_50": 1.37,
                "High_50": 1.52
            },
            "2020-02-06": {
                "ML": 1.13,
                "Low_50": 1.03,
                "High_50": 1.18
            },
            "2020-02-07": {
                "ML": 0.9,
                "Low_50": 0.82,
                "High_50": 0.97
            },
            "2020-02-08": {
                "ML": 0.68,
                "Low_50": 0.57,
                "High_50": 0.73
            },
            "2020-02-09": {
                "ML": 0.5,
                "Low_50": 0.4,
                "High_50": 0.56
            },
            "2020-02-10": {
                "ML": 2.17,
                "Low_50": 2.07,
                "High_50": 2.22
            },
            "2020-02-11": {
                "ML": 2.28,
                "Low_50": 2.18,
                "High_50": 2.32
            },
            "2020-02-12": {
                "ML": 2.13,
                "Low_50": 2.03,
                "High_50": 2.16
            },
            "2020-02-13": {
                "ML": 1.55,
                "Low_50": 1.49,
                "High_50": 1.61
            },
            "2020-02-14": {
                "ML": 0.67,
                "Low_50": 0.57,
                "High_50": 0.7
            },
            "2020-02-15": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.05
            },
            "2020-02-16": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.04
            },
            "2020-02-17": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.0
            },
            "2020-02-18": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.05
            },
            "2020-02-19": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.07
            },
            "2020-02-20": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.06
            },
            "2020-02-21": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.06
            },
            "2020-02-22": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.08
            },
            "2020-02-23": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.1
            },
            "2020-02-24": {
                "ML": 0.17,
                "Low_50": 0.01,
                "High_50": 0.23
            },
            "2020-02-25": {
                "ML": 0.11,
                "Low_50": 0.0,
                "High_50": 0.2
            },
            "2020-02-26": {
                "ML": 0.27,
                "Low_50": 0.11,
                "High_50": 0.38
            },
            "2020-02-27": {
                "ML": 0.59,
                "Low_50": 0.39,
                "High_50": 0.72
            },
            "2020-02-28": {
                "ML": 0.8,
                "Low_50": 0.59,
                "High_50": 0.93
            },
            "2020-02-29": {
                "ML": 0.65,
                "Low_50": 0.44,
                "High_50": 0.78
            },
            "2020-03-01": {
                "ML": 0.41,
                "Low_50": 0.21,
                "High_50": 0.54
            },
            "2020-03-02": {
                "ML": 0.06,
                "Low_50": 0.0,
                "High_50": 0.21
            },
            "2020-03-03": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.15
            },
            "2020-03-04": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.14
            },
            "2020-03-05": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.16
            },
            "2020-03-06": {
                "ML": 0.12,
                "Low_50": 0.0,
                "High_50": 0.24
            },
            "2020-03-07": {
                "ML": 0.13,
                "Low_50": 0.0,
                "High_50": 0.26
            },
            "2020-03-08": {
                "ML": 0.08,
                "Low_50": 0.0,
                "High_50": 0.24
            },
            "2020-03-09": {
                "ML": 0.06,
                "Low_50": 0.0,
                "High_50": 0.23
            },
            "2020-03-10": {
                "ML": 0.06,
                "Low_50": 0.0,
                "High_50": 0.23
            },
            "2020-03-11": {
                "ML": 0.13,
                "Low_50": 0.0,
                "High_50": 0.27
            },
            "2020-03-12": {
                "ML": 0.21,
                "Low_50": 0.0,
                "High_50": 0.33
            },
            "2020-03-13": {
                "ML": 0.26,
                "Low_50": 0.01,
                "High_50": 0.39
            },
            "2020-03-14": {
                "ML": 0.35,
                "Low_50": 0.11,
                "High_50": 0.55
            },
            "2020-03-15": {
                "ML": 0.42,
                "Low_50": 0.16,
                "High_50": 0.66
            },
            "2020-03-16": {
                "ML": 0.56,
                "Low_50": 0.2,
                "High_50": 0.79
            },
            "2020-03-17": {
                "ML": 0.91,
                "Low_50": 0.48,
                "High_50": 1.17
            },
            "2020-03-18": {
                "ML": 1.25,
                "Low_50": 0.84,
                "High_50": 1.55
            },
            "2020-03-19": {
                "ML": 1.52,
                "Low_50": 1.11,
                "High_50": 1.8
            },
            "2020-03-20": {
                "ML": 1.78,
                "Low_50": 1.41,
                "High_50": 2.06
            },
            "2020-03-21": {
                "ML": 1.82,
                "Low_50": 1.5,
                "High_50": 2.11
            },
            "2020-03-22": {
                "ML": 1.79,
                "Low_50": 1.49,
                "High_50": 2.07
            },
            "2020-03-23": {
                "ML": 1.7,
                "Low_50": 1.38,
                "High_50": 1.94
            },
            "2020-03-24": {
                "ML": 1.51,
                "Low_50": 1.17,
                "High_50": 1.72
            },
            "2020-03-25": {
                "ML": 1.47,
                "Low_50": 1.15,
                "High_50": 1.69
            },
            "2020-03-26": {
                "ML": 1.42,
                "Low_50": 1.11,
                "High_50": 1.64
            },
            "2020-03-27": {
                "ML": 1.33,
                "Low_50": 1.0,
                "High_50": 1.53
            },
            "2020-03-28": {
                "ML": 1.31,
                "Low_50": 1.01,
                "High_50": 1.53
            },
            "2020-03-29": {
                "ML": 1.15,
                "Low_50": 0.84,
                "High_50": 1.36
            },
            "2020-03-30": {
                "ML": 1.0,
                "Low_50": 0.7,
                "High_50": 1.22
            },
            "2020-03-31": {
                "ML": 0.84,
                "Low_50": 0.51,
                "High_50": 1.04
            },
            "2020-04-01": {
                "ML": 0.72,
                "Low_50": 0.38,
                "High_50": 0.91
            },
            "2020-04-02": {
                "ML": 0.62,
                "Low_50": 0.33,
                "High_50": 0.85
            },
            "2020-04-03": {
                "ML": 0.57,
                "Low_50": 0.24,
                "High_50": 0.76
            },
            "2020-04-04": {
                "ML": 0.54,
                "Low_50": 0.23,
                "High_50": 0.75
            },
            "2020-04-05": {
                "ML": 0.61,
                "Low_50": 0.29,
                "High_50": 0.83
            },
            "2020-04-06": {
                "ML": 0.69,
                "Low_50": 0.37,
                "High_50": 0.93
            },
            "2020-04-07": {
                "ML": 0.82,
                "Low_50": 0.5,
                "High_50": 1.08
            },
            "2020-04-08": {
                "ML": 0.97,
                "Low_50": 0.65,
                "High_50": 1.24
            },
            "2020-04-09": {
                "ML": 1.05,
                "Low_50": 0.7,
                "High_50": 1.29
            },
            "2020-04-10": {
                "ML": 1.17,
                "Low_50": 0.82,
                "High_50": 1.4
            },
            "2020-04-11": {
                "ML": 1.24,
                "Low_50": 0.89,
                "High_50": 1.46
            },
            "2020-04-12": {
                "ML": 1.22,
                "Low_50": 0.87,
                "High_50": 1.43
            },
            "2020-04-13": {
                "ML": 1.1,
                "Low_50": 0.79,
                "High_50": 1.34
            },
            "2020-04-14": {
                "ML": 1.44,
                "Low_50": 1.14,
                "High_50": 1.68
            },
            "2020-04-15": {
                "ML": 1.47,
                "Low_50": 1.14,
                "High_50": 1.67
            },
            "2020-04-16": {
                "ML": 1.42,
                "Low_50": 1.13,
                "High_50": 1.64
            },
            "2020-04-17": {
                "ML": 1.18,
                "Low_50": 0.86,
                "High_50": 1.37
            },
            "2020-04-18": {
                "ML": 0.78,
                "Low_50": 0.46,
                "High_50": 0.97
            },
            "2020-04-19": {
                "ML": 0.28,
                "Low_50": 0.03,
                "High_50": 0.43
            },
            "2020-04-20": {
                "ML": 0.07,
                "Low_50": 0.0,
                "High_50": 0.26
            },
            "2020-04-21": {
                "ML": 0.0,
                "Low_50": 0.0,
                "High_50": 0.19
            },
            "2020-04-22": {
                "ML": 0.16,
                "Low_50": 0.0,
                "High_50": 0.29
            },
            "2020-04-23": {
                "ML": 0.22,
                "Low_50": 0.0,
                "High_50": 0.34
            },
            "2020-04-24": {
                "ML": 0.25,
                "Low_50": 0.01,
                "High_50": 0.39
            },
            "2020-04-25": {
                "ML": 0.29,
                "Low_50": 0.03,
                "High_50": 0.45
            },
            "2020-04-26": {
                "ML": 0.31,
                "Low_50": 0.05,
                "High_50": 0.5
            },
            "2020-04-27": {
                "ML": 0.35,
                "Low_50": 0.08,
                "High_50": 0.57
            },
            "2020-04-28": {
                "ML": 0.36,
                "Low_50": 0.09,
                "High_50": 0.6
            },
            "2020-04-29": {
                "ML": 0.36,
                "Low_50": 0.06,
                "High_50": 0.59
            },
            "2020-04-30": {
                "ML": 0.37,
                "Low_50": 0.08,
                "High_50": 0.62
            },
            "2020-05-01": {
                "ML": 0.34,
                "Low_50": 0.05,
                "High_50": 0.58
            },
            "2020-05-02": {
                "ML": 0.35,
                "Low_50": 0.05,
                "High_50": 0.59
            },
            "2020-05-03": {
                "ML": 0.35,
                "Low_50": 0.04,
                "High_50": 0.59
            },
            "2020-05-04": {
                "ML": 0.35,
                "Low_50": 0.07,
                "High_50": 0.62
            },
            "2020-05-05": {
                "ML": 0.37,
                "Low_50": 0.08,
                "High_50": 0.66
            },
            "2020-05-06": {
                "ML": 0.39,
                "Low_50": 0.08,
                "High_50": 0.69
            },
            "2020-05-07": {
                "ML": 0.41,
                "Low_50": 0.06,
                "High_50": 0.7
            },
            "2020-05-08": {
                "ML": 0.5,
                "Low_50": 0.13,
                "High_50": 0.86
            },
            "2020-05-09": {
                "ML": 0.64,
                "Low_50": 0.23,
                "High_50": 1.05
            },
            "2020-05-10": {
                "ML": 0.74,
                "Low_50": 0.26,
                "High_50": 1.13
            },
            "2020-05-11": {
                "ML": 0.85,
                "Low_50": 0.31,
                "High_50": 1.22
            },
            "2020-05-12": {
                "ML": 0.74,
                "Low_50": 0.26,
                "High_50": 1.13
            },
            "2020-05-13": {
                "ML": 0.73,
                "Low_50": 0.27,
                "High_50": 1.14
            },
            "2020-05-14": {
                "ML": 0.62,
                "Low_50": 0.17,
                "High_50": 1.01
            },
            "2020-05-15": {
                "ML": 0.54,
                "Low_50": 0.16,
                "High_50": 0.96
            },
            "2020-05-16": {
                "ML": 0.63,
                "Low_50": 0.2,
                "High_50": 1.05
            },
            "2020-05-17": {
                "ML": 0.64,
                "Low_50": 0.26,
                "High_50": 1.11
            },
            "2020-05-18": {
                "ML": 0.65,
                "Low_50": 0.2,
                "High_50": 1.06
            },
            "2020-05-19": {
                "ML": 0.65,
                "Low_50": 0.23,
                "High_50": 1.09
            },
            "2020-05-20": {
                "ML": 0.57,
                "Low_50": 0.21,
                "High_50": 1.03
            },
            "2020-05-21": {
                "ML": 0.5,
                "Low_50": 0.13,
                "High_50": 0.92
            },
            "2020-05-22": {
                "ML": 0.52,
                "Low_50": 0.14,
                "High_50": 0.94
            },
            "2020-05-23": {
                "ML": 0.6,
                "Low_50": 0.22,
                "High_50": 1.07
            },
            "2020-05-24": {
                "ML": 0.61,
                "Low_50": 0.19,
                "High_50": 1.05
            },
            "2020-05-25": {
                "ML": 0.62,
                "Low_50": 0.25,
                "High_50": 1.11
            },
            "2020-05-26": {
                "ML": 0.54,
                "Low_50": 0.12,
                "High_50": 0.95
            },
            "2020-05-27": {
                "ML": 0.55,
                "Low_50": 0.18,
                "High_50": 1.01
            },
            "2020-05-28": {
                "ML": 0.56,
                "Low_50": 0.17,
                "High_50": 1.01
            },
            "2020-05-29": {
                "ML": 0.66,
                "Low_50": 0.26,
                "High_50": 1.15
            },
            "2020-05-30": {
                "ML": 0.91,
                "Low_50": 0.36,
                "High_50": 1.34
            },
            "2020-05-31": {
                "ML": 1.03,
                "Low_50": 0.48,
                "High_50": 1.48
            },
            "2020-06-01": {
                "ML": 1.01,
                "Low_50": 0.39,
                "High_50": 1.38
            },
            "2020-06-02": {
                "ML": 0.99,
                "Low_50": 0.42,
                "High_50": 1.39
            },
            "2020-06-03": {
                "ML": 0.72,
                "Low_50": 0.23,
                "High_50": 1.12
            },
            "2020-06-04": {
                "ML": 0.71,
                "Low_50": 0.22,
                "High_50": 1.11
            },
            "2020-06-05": {
                "ML": 0.59,
                "Low_50": 0.16,
                "High_50": 1.01
            },
            "2020-06-06": {
                "ML": 0.6,
                "Low_50": 0.2,
                "High_50": 1.05
            },
            "2020-06-07": {
                "ML": 0.6,
                "Low_50": 0.16,
                "High_50": 1.02
            },
            "2020-06-08": {
                "ML": 0.61,
                "Low_50": 0.2,
                "High_50": 1.06
            },
            "2020-06-09": {
                "ML": 0.62,
                "Low_50": 0.16,
                "High_50": 1.03
            },
            "2020-06-10": {
                "ML": 0.73,
                "Low_50": 0.27,
                "High_50": 1.18
            },
            "2020-06-11": {
                "ML": 1.22,
                "Low_50": 0.6,
                "High_50": 1.64
            },
            "2020-06-12": {
                "ML": 1.84,
                "Low_50": 1.23,
                "High_50": 2.29
            },
            "2020-06-13": {
                "ML": 2.26,
                "Low_50": 1.72,
                "High_50": 2.69
            },
            "2020-06-14": {
                "ML": 2.49,
                "Low_50": 2.0,
                "High_50": 2.87
            },
            "2020-06-15": {
                "ML": 2.33,
                "Low_50": 1.88,
                "High_50": 2.67
            },
            "2020-06-16": {
                "ML": 2.11,
                "Low_50": 1.65,
                "High_50": 2.39
            },
            "2020-06-17": {
                "ML": 1.79,
                "Low_50": 1.4,
                "High_50": 2.1
            },
            "2020-06-18": {
                "ML": 1.5,
                "Low_50": 1.08,
                "High_50": 1.77
            },
            "2020-06-19": {
                "ML": 1.28,
                "Low_50": 0.86,
                "High_50": 1.55
            },
            "2020-06-20": {
                "ML": 1.19,
                "Low_50": 0.78,
                "High_50": 1.47
            }
        },
    };

    let processedData = formatJson(myJsonData);

    console.log(processedData);

    const data = [
        {
            id: 'belowOne',
            data: [
                { x: '2018-01-01', y: .80 },
                { x: '2018-02-01', y: .90},
                { x: '2018-03-01', y: .60 },
                { x: '2018-04-01', y: .80 },
                { x: '2018-05-01', y: null },
                { x: '2018-06-01', y: null },
                { x: '2018-07-01', y: null },
                { x: '2018-08-01', y: null },
            ],
        },
        {
            id: 'aboveOne',
            data: [
                { x: '2018-01-01', y: null },
                { x: '2018-02-01', y: null},
                { x: '2018-03-01', y: null },
                { x: '2018-04-01', y: .80 },
                { x: '2018-05-01', y: 1.10 },
                { x: '2018-06-01', y: 1.00 },
                { x: '2018-07-01', y: 1.50 },
                { x: '2018-08-01', y: 1.70 },
            ],
        },
    ];

    return (
        <div className={classes.root}>
            <GridList cellHeight={400} className={classes.gridList} cols={3}>
                {processedData.map((country, index) => (
                    <GridListTile key={index} cols={country.cols || 1}>
                        <div style={{height:380,}}>
                            <ChartCard rtValue={country.data[data.length -1].y} country={country.id} data={[country] || []}/>
                        </div>
                    </GridListTile>
                ))}
            </GridList>
        </div>
    );
}
